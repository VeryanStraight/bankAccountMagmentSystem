CREATE DATABASE issueSystem;
USE issueSystem

CREATE TABLE users(
	username VARCHAR(20) PRIMARY KEY,
	password VARCHAR(50) NOT NULL,
	name VARCHAR(40)
);

CREATE TABLE managers_subordinates(
	manager VARCHAR(20),
	subordinate VARCHAR(20),
	
	CONSTRAINT ms_pk PRIMARY KEY (manager, subordinate),
	CONSTRAINT m_fk FOREIGN KEY (manager)
	REFERENCES users (username),
	CONSTRAINT s_fk FOREIGN KEY (subordinate)
	REFERENCES users (username)
);

CREATE TABLE categories(
	id INT AUTO_INCREMENT PRIMARY KEY,
	category VARCHAR(20) UNIQUE NOT NULL
);


CREATE TABLE statuses(
	id INT AUTO_INCREMENT PRIMARY KEY,
	status VARCHAR(20) UNIQUE NOT NULL
);

INSERT INTO statuses VALUES (1, "backlog");

CREATE TABLE issues(
	id INT AUTO_INCREMENT PRIMARY KEY,
	creator VARCHAR(20) NOT NULL,
	assignee VARCHAR(20),
	title TEXT NOT NULL,
	description TEXT,
	start DATE NOT NULL,
	end DATE,
	category INT NOT NULL,
	status INT NOT NULL DEFAULT 1,
	
	CONSTRAINT c_fk FOREIGN KEY (creator)
	REFERENCES users (username),
	CONSTRAINT a_fk FOREIGN KEY (assignee)
	REFERENCES users (username),
	CONSTRAINT cat_fk FOREIGN KEY (category)
	REFERENCES categories (id),
	CONSTRAINT stat_fk FOREIGN KEY (status)
	REFERENCES statuses (id)
);

CREATE TABLE members_issues(
	member VARCHAR(20),
	issue INT,
	
	CONSTRAINT mi_pk PRIMARY KEY (member, issue),
	CONSTRAINT i_fk FOREIGN KEY (issue) 
	REFERENCES issues (id),
	CONSTRAINT mem_fk FOREIGN KEY (member) 
	REFERENCES users (username)
);

CREATE TABLE subissues(
	issue INT,
	subissue INT, 
	CONSTRAINT issue_fk FOREIGN KEY (issue)
	REFERENCES issues (id),
	CONSTRAINT subissue_fk FOREIGN KEY (issue)
	REFERENCES issues (id)
);

INSERT INTO categories (category)
VALUES ("bug"),
		("feature"),
		("enhancement"),
		("testing");
		
INSERT INTO statuses (status)
VALUES ("in progress"),
		("done"),
		("late"),
		("cancled");
		
INSERT INTO users
VALUES ("username", "password", "name"),
		("sasmith", "12345", "sam"),
		("tojhonson", "abcd", "tom"),
		("jabaker", "1q2w3e", "jake"),
		("sacarp", "qwerty", "sally");
		
INSERT INTO managers_subordinates
VALUES ("sacarp", "jabaker"),
		("sacarp", "tojhonson"),
		("tojhonson", "username");
		
INSERT INTO issues (creator, assignee, title, description, start, end, status, category)
VALUES ("sacarp", "tojhonson", "title", "discription", '2024-10-01', '2024-11-01', 1, 2),
		("sacarp", "sacarp", "add data", null, '2024-10-01', '2024-10-02', 3, 3),
		("sasmith", "sasmith", "make code", "do java", '2024-10-01', '2024-12-02', 2, 4),
		("sasmith", "sasmith", "make gui", "do wireframe", '2024-10-01', '2024-12-02', 4, 2),
		("username", "username", "todo", "do thing", '2024-02-01', '2024-05-02', 5, 5);
		
INSERT INTO members_issues
VALUES ("jabaker", 6),
		("username", 6),
		("jabaker", 10);
		
INSERT INTO subissues
VALUES (6, 7),
		(7, 8),
		(6, 9);